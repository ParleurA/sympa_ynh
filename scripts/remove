#!/bin/bash
set -u

# Source YunoHost helpers
source /usr/share/yunohost/helpers

# Retrieve app settings
APP=$YNH_APP_INSTANCE_NAME
DOMAIN=$(ynh_app_setting_get "$APP" domain)

# FIXME FIXME FIXME
# Add tests that stuff actually exists before removing them

# Remove nginx configuration file
sudo rm -f /etc/nginx/conf.d/$DOMAIN.d/$APP.conf

# Remove yunohost custom hooks
rm /usr/share/yunohost/hooks/conf_regen/98-postfix_sympa
rm /usr/share/yunohost/hooks/conf_regen/99-sympa

# Remove sympa services
yunohost service remove sympa

cd /etc/systemd/system/
systemctl disable sympa.service
systemctl disable sympa-fcgi.service
rm sympa*
systemctl daemon-reload

# Remove home dir / install dir
install_dir="/home/sympa"
rm -rf $install_dir

# Remove mysql table
ynh_mysql_drop_user sympa
ynh_mysql_drop_db sympa

# Reload nginx service
sudo service nginx reload
